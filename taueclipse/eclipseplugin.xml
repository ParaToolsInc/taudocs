<?xml version="1.0"?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.4//EN"
                 "../tools/docbook-xml-4.4/docbookx.dtd"> 

<chapter id="EclipsePlugin">
  <title>Eclipse PTP / CDT plug-in System</title>

<sect1 id="InstallEclipse">
<title>Installation</title>

<para>Be certain that the <ulink url='http://www.eclipse.org/ptp/downloads.php'>PTP</ulink>/<ulink
url='http://www.eclipse.org/cdt/downloads.php'>CDT</ulink>/<ulink
url='http://www.eclipse.org/photran/download.php'>Photran</ulink> plug-ins are installed and running
properly in your eclipse installation.  Use Tau's perfdmf_configure utility to
set up a performance database for Eclipse to store profile output.</para>

<para>Run the install_plug-ins.sh script located in <literal>[tau
installation]/tools/src/eclipse</literal> with the location of your eclipse
installation. e.g:  <literal>~/tau2/tools/src/eclipse/install_plug-ins.sh
/opt/eclipse</literal></para>

<para>Restart eclipse with the -clean flag after installing the plugins.</para>

<note>
  <para>By default Eclipse will detect the presence of TAU on your system and
configure itself appropriately so long as the TAU bin directory is in your path. Only if this fails will you need to setup the TAU
preferences manually.
  </para>
</note>

<para>In eclipse go to the Window menu, select Preferences and go to the Performance Tools
preferences section and the Tool Configuration subsection. If the PTP is available the Performance Tools section will be under the
PTP menu.  Enter the location of the desired TAU bin directory in your in the tau Bin Directory field.</para>
  <figure>
  	<title>TAU Setup</title>
	<mediaobject>
	  <imageobject role="html">
	    <imagedata fileref="TauSetup.png"/> 
	  </imageobject> 

	  <imageobject role="fo"> 
	    <imagedata fileref="TauSetup.png"/> 
	  </imageobject> 
	</mediaobject>
  </figure>

</sect1>

<sect1 id="TauLaucher">
<title>Creating a Tau Launch Configuration</title>

<para>To create a TAU launch configuration, click the profile button added near
the run and debug buttons.  This will provide an interface for launching either a standard or parallel C,
C++ or Fortran application, similar to the interface provided by the standard run configuration dialog.  You may select a pre-existing run configuration or create
a new one in the usual way.</para>
  <figure>
  	<title>TAU Launch Configuration</title>
	<mediaobject>
	  <imageobject role="html">
	    <imagedata fileref="AnalysisTab.png"/> 
	  </imageobject> 

	  <imageobject role="fo"> 
	    <imagedata fileref="AnalysisTab.png"/> 
	  </imageobject> 
	</mediaobject>
  </figure>

<para>The run configuration options are equivalent to those of a standard run
configuration, with the addition of a performance analysis tab a parametric study tab and a TAU tab.  To run an application with TAU first make sure that the TAU option is selected in the drop down box on the performance analysis tab.
You may also specify that a Tau instrumented executable should not be run after it is built.
This option will leave a new TAU specific build configuration available for
your use.  It will have the name of the original build configuration, with the
tau configuration options used appended.  The executables available in such
build configurations can be run through the standard run and debug launch
configurations.  This option can be useful if you need to launch Tau
instrumented binaries outside of eclipse.  There is also an option to select existing performance data.  This will upload data specified on the filesystem to a selected database, rather than generating the data from a project in Eclipse.
</para>
<para>
On the TAU tab you must select
a Tau makefile from the available makefiles in the Tau architecture directory
you specified.  You may select specific configuration options to narrow the list
of makefiles in the dropdown box.  Only makefiles configured with the
<literal>-pdt</literal>
option will be listed.  Additional Tau compiler options are provided on the Tau Compiler sub-tab.</para>

<para>If you select a makefile with the PAPI counter library and
<literal>-MULTIPLECOUNTERS</literal>
enabled you may specify the PAPI environment variables using the Select PAPI
Counters button. The counters you select will be placed in the environment
variables list for your run configuration.</para>

<para>You may specify the use of TAU selective instrumentation either by
selecting a pre-defined selective instrumentation file, by selecting the
internal option to have Tau to use a file generated by the selective
instrumentation commands available in the Eclipse workspace or by selecting the automatic option to have eclipse generate a selective instrumentation file using TAU's tau_reduce utility.  Note that the automatic option will cause your project to be rebuilt and run twice.</para>

<para>By default TAU profile data will only be stored in a perfdmf
database, if available.  The database may be selected on the Data Collection sub-tab.  You may specify that performance data should be kept on
the file-system with the Keep Profiles option.</para>

<para>If you wish to collect the resulting profile data on <ulink
url="http://tau.nic.uoregon.edu">TAU's online Portal</ulink>,
check the "Upload profile data to TAU Portal" box. After the profiling has
finished you will be prompted to provide your user name, password and specify
the destination workspace. To view the profile data log on to the portal and
select the specified workspace.</para>

</sect1>
<!--
<sect1 id="ManagedMake">

<title>Building and launching Managed Make projects with TAU</title>

<para>Managed make projects can also be run automatically with Tau.  To do so
you must name the compilers in your makefile <literal>ECLIPSE_CC,
ECLIPSE_CXX</literal> and
<literal>ECLIPSE_FC</literal> for C, C++ and Fortran compilers respectively.  Define the the
compilers in an eclipse.inc file in your project's top level directory and
ensure that this file is included by your makefile.</para>
</sect1>
-->
<sect1 id="SelectiveLaunch">

<title>Selective Instrumentation</title>

<para>C, C++ and Fortran programs have several selective instrumentation options
in Eclipse.  The selective instrumentation sub-menu of the right click menu
provided by C/C++ and Fortran projects, source files and routines in the C/C++
and program outline views allows inclusion, exclusion and loop level
instrumentation to be specified for each of these objects.  You may also clear
instrumentation specified for each of these levels from the selective
instrumentation menu.</para>

<para>The source editor's context menu allows the insertion of interval and
atomic user defined events.  To specify an atomic user defined event, place the
cursor on the line where you want the event to trigger, right click, go to the
Selective Instrumentation sub-menu and select Insert TAU Atomic User Defined
Event.  Put the name you wish to associate with the event in the first context
window that appears.  Put either a numeric constant or the name of a valid
numeric variable in the second window.</para>

  <figure>
  	<title>Optional User Defined Events</title>
	<mediaobject>
	  <imageobject role="html">
	    <imagedata fileref="UDEs.png"/> 
	  </imageobject> 

	  <imageobject role="fo"> 
	    <imagedata fileref="UDEs.png"/> 
	  </imageobject> 
	</mediaobject>
  </figure>

<para>To specify an interval based user defined event, select the source code
you wish to be included in the interval, right click, go to the Selective
Instrumentation sub-menu and select Insert TAU Interval (start/stop) User
Defined Event.  You may select use of a Static Timer, Dynamic Timer, Static
Phase or Dynamic Phase event.  Note that to get phase data you must select a Tau
makefile configured with the <literal>-PROFILEPHASE</literal> option.  Once you have selected the
event type you will be prompted to enter a name for the event.</para>

  <figure>
  	<title>Adding User Defined Events</title>
	<mediaobject>
	  <imageobject role="html">
	    <imagedata fileref="Context.png"/> 
	  </imageobject> 

	  <imageobject role="fo"> 
	    <imagedata fileref="UDEs.png"/> 
	  </imageobject> 
	</mediaobject>
  </figure>
<para>All selective instrumentation options are placed in the tau.selective file
in your project's main directory.  This file is automatically employed when the
Tau launch configuration has "internal" selective instrumentation selected.  You
may safely edit this file manually so long as it remains a valid Tau selective
instrumentation file.</para>

</sect1>

<sect1 id="CollectingData">
<title>Launching a Program and Collecting Data</title>

<para>To launch your project with Tau either select the Profile button from the
profile launch configuration window, select your launch configuration from the
dropdown menu of the profile button or, if your desired configuration is already
selected, simply click on the profile button. </para>

<para>If a perfdmf database is configured and available, Tau profile data will
be saved there. Trace data and other performance data output will be stored in
your project's top level directory.  If a perfdmf database is not available or
you have selected to save profile data on the file system profile output will
appear in a Profiles directory in your project's top level directory.  Profiles
are organized in sub-directories by the Tau configuration options used to
generate them and the time-stamp of their creation.</para>

</sect1>
</chapter>
